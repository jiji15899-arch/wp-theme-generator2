// generator.js - 워드프레스 테마 생성 로직

let generatedZip = null;

function showAlert(message, type = 'error') {
    const container = document.getElementById('alertContainer');
    const alert = document.createElement('div');
    alert.className = `alert alert-${type}`;
    alert.textContent = message;
    container.appendChild(alert);
    
    setTimeout(() => {
        alert.remove();
    }, 5000);
}

function validateInputs() {
    const themeName = document.getElementById('themeName').value.trim();
    const themeSlug = document.getElementById('themeSlug').value.trim();
    const keywords = Array.from(document.querySelectorAll('.keyword-input'))
        .map(input => input.value.trim())
        .filter(k => k);
    
    if (!themeName) {
        showAlert('테마 이름을 입력해주세요.');
        return false;
    }
    
    if (!themeSlug) {
        showAlert('테마 슬러그를 입력해주세요.');
        return false;
    }
    
    if (!/^[a-z0-9-]+$/.test(themeSlug)) {
        showAlert('테마 슬러그는 영문 소문자, 숫자, 하이픈만 사용 가능합니다.');
        return false;
    }
    
    if (keywords.length === 0) {
        showAlert('최소 1개의 키워드를 입력해주세요.');
        return false;
    }
    
    return true;
}

function getFormData() {
    const keywords = Array.from(document.querySelectorAll('.keyword-input'))
        .map(input => input.value.trim())
        .filter(k => k);
    
    const tabs = [];
    const activeTab = document.querySelector('input[name="activeTab"]:checked').value;
    
    for (let i = 1; i <= 3; i++) {
        const name = document.getElementById(`tab${i}Name`).value.trim();
        const url = document.getElementById(`tab${i}Url`).value.trim();
        if (name) {
            tabs.push({
                name,
                url: url || '#',
                active: i == activeTab
            });
        }
    }
    
    return {
        themeName: document.getElementById('themeName').value.trim(),
        themeSlug: document.getElementById('themeSlug').value.trim(),
        siteTitle: document.getElementById('siteTitle').value.trim() || '지원금 스킨',
        mainUrl: document.getElementById('mainUrl').value.trim() || 'https://example.com',
        tabs,
        keywords,
        adClientId: document.getElementById('adClientId').value.trim(),
        adSlotId: document.getElementById('adSlotId').value.trim(),
        businessName: document.getElementById('businessName').value.trim() || '블로그(사업자)명',
        businessAddress: document.getElementById('businessAddress').value.trim() || '사업자 주소',
        businessNumber: document.getElementById('businessNumber').value.trim() || '123-45-67890'
    };
}

async function generateCardData(keywords) {
    try {
        const response = await fetch("https://api.anthropic.com/v1/messages", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                model: "claude-sonnet-4-20250514",
                max_tokens: 2000,
                messages: [{
                    role: "user",
                    content: `다음 키워드들에 대해 각각 후킹성 있고 정확한 카드 내용을 만들어줘.

키워드: ${keywords.join(', ')}

각 키워드에 대해 다음 형식의 JSON 배열로만 답변해:
[
  {
    "keyword": "키워드명",
    "amount": "금액/혜택 강조 (예: 최대 4.5% 금리, 월 50만원, 최대 5000만원)",
    "amountSub": "부가 설명 (예: 비과세 + 대출 우대, 최대 6개월 지급)",
    "description": "한 줄 설명 (예: 청년 무주택자를 위한 높은 금리의 우대형 청약통장)",
    "target": "지원대상 (예: 만 19~34세 청년) - 반드시 20글자 이내",
    "period": "신청시기 (예: 상시, 매년 5월)"
  }
]

주의사항:
- 실제 정책/제도 정보에 기반하여 정확하게 작성
- amount는 숫자와 단위를 포함한 임팩트 있는 문구
- target(지원대상)은 반드시 공백 포함 20글자 이내로 작성
- 후킹성 있게 작성하되 허위정보는 금지
- JSON만 출력, 다른 텍스트 없이`
                }]
            })
        });

        const data = await response.json();
        let jsonText = data.content?.find(item => item.type === "text")?.text || "[]";
        jsonText = jsonText.replace(/```json\n?/g, "").replace(/```\n?$/g, "").trim();
        return JSON.parse(jsonText);
    } catch (error) {
        console.error("AI 생성 오류:", error);
        return keywords.map(k => ({
            keyword: k,
            amount: "최대 300만원",
            amountSub: "신청자 평균 수령액",
            description: "정부 지원금 프로그램",
            target: "전 국민",
            period: "상시"
        }));
    }
}

function generateStyleCSS(data) {
    return `/*
Theme Name: ${data.themeName}
Theme URI: ${data.mainUrl}
Author: 아로스
Author URI: https://aros100.com
Description: AI 기반 지원금 전용 워드프레스 테마
Version: 1.0
License: GNU General Public License v2 or later
License URI: http://www.gnu.org/licenses/gpl-2.0.html
Text Domain: ${data.themeSlug}
*/

/* ========== Reset & Base ========== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
    background: #ffffff;
    color: #1a1a1a;
    line-height: 1.6;
    padding-top: 120px;
}

.container {
    max-width: 768px;
    margin: 0 auto;
    padding: 8px;
}

/* ========== Header ========== */
.site-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: white;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.header-container {
    max-width: 768px;
    margin: 0 auto;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
}

.site-logo {
    height: 30px;
    width: auto;
}

.site-title {
    font-size: 20px;
    font-weight: 600;
    color: #000;
    margin: 0;
}

/* ========== Tab Navigation ========== */
.tab-wrapper {
    position: fixed;
    top: 62px;
    left: 0;
    width: 100%;
    background: white;
    z-index: 999;
    padding: 8px;
}

.tab-container {
    max-width: 768px;
    margin: 0 auto;
    background: white;
    border-radius: 50px;
    padding: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.tabs {
    display: flex;
    justify-content: space-between;
    list-style: none;
    padding: 0;
    margin: 0;
}

.tab-item {
    flex: 1;
    text-align: center;
}

.tab-link {
    display: block;
    padding: 12px 8px;
    text-decoration: none;
    color: #6B7280;
    border-radius: 25px;
    transition: all 0.3s ease;
    font-size: 14px;
    font-weight: 500;
}

.tab-link:hover {
    color: #3182F6;
    background: #F0F9FF;
}

.tab-link.active {
    background: linear-gradient(135deg, #3182F6 0%, #1E6AD4 100%);
    color: white;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(49, 130, 246, 0.3);
}

/* ========== Intro Section ========== */
.intro-section {
    text-align: center;
    padding: 32px 20px 24px;
}

.intro-badge {
    display: inline-block;
    background: #cfdefa;
    color: #2f42d4;
    padding: 8px 16px;
    border-radius: 50px;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 16px;
}

.intro-sub {
    font-size: 25px;
    color: #374151;
    margin-bottom: 8px;
}

.intro-title {
    font-size: 35px;
    font-weight: 800;
    color: #2f42d4;
    letter-spacing: -0.5px;
    margin: 0;
}

/* ========== Info Box ========== */
.info-box {
    background: #F0F9FF;
    border-radius: 16px;
    padding: 24px;
    margin: 20px 0;
    border-left: 4px solid #3182F6;
}

.info-box-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
}

.info-box-title {
    font-size: 20px;
    font-weight: 700;
    color: #1a1a1a;
}

.info-box-amount {
    font-size: 19px;
    font-weight: 700;
    color: #3182F6;
    margin-bottom: 8px;
}

.info-box-desc {
    font-size: 16px;
    color: #6B7280;
    line-height: 1.6;
}

/* ========== Card Grid ========== */
.info-card-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
    margin: 30px 0;
}

.info-card {
    background: #ffffff;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    text-decoration: none;
    color: inherit;
    overflow: hidden;
    border: 1px solid rgba(0, 0, 0, 0.04);
}

.info-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 20px 40px rgba(49, 130, 246, 0.15);
}

.info-card-highlight {
    background: linear-gradient(135deg, #3182F6 0%, #1E6AD4 100%);
    padding: 24px 24px 20px;
    position: relative;
}

.info-card.featured .info-card-highlight {
    background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%);
}

.info-card-badge {
    position: relative;
    overflow: hidden;
    display: inline-block;
    background: rgba(255, 255, 255, 0.2);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    color: #fff;
    margin-bottom: 12px;
}

.info-card-amount {
    font-size: 32px;
    font-weight: 800;
    color: #ffffff;
    letter-spacing: -1px;
    line-height: 1.2;
}

.info-card-amount-sub {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 500;
    margin-top: 6px;
}

.info-card-content {
    padding: 24px;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
}

.info-card-title {
    font-size: 18px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.info-card-desc {
    font-size: 14px;
    color: #71717a;
    line-height: 1.6;
    margin-bottom: 20px;
    flex-grow: 1;
}

.info-card-details {
    background: #F0F9FF;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 20px;
}

.info-card-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
}

.info-card-row:not(:last-child) {
    border-bottom: 1px dashed #bfdbfe;
    padding-bottom: 10px;
    margin-bottom: 10px;
}

.info-card-label {
    font-size: 13px;
    color: #64748b;
    font-weight: 500;
}

.info-card-value {
    font-size: 13px;
    font-weight: 600;
    color: #1e3a5f;
}

.info-card-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 16px 20px;
    background: linear-gradient(135deg, #3182F6 0%, #1E6AD4 100%);
    color: white;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(49, 130, 246, 0.3);
}

.info-card-btn:hover {
    background: linear-gradient(135deg, #1E6AD4 0%, #1556B0 100%);
    transform: translateY(-2px);
}

/* ========== Ad Card ========== */
.ad-card {
    background: #ffffff;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
    border: 1px solid rgba(0, 0, 0, 0.04);
    padding: 16px;
    margin: 24px 0;
    text-align: center;
}

/* ========== Hero Section ========== */
.hero-section {
    background: linear-gradient(135deg, #2563EB 0%, #3182F6 50%, #0EA5E9 100%);
    border-radius: 24px;
    padding: 40px 32px;
    margin: 30px 0;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.hero-urgent {
    display: inline-block;
    background: rgba(255, 255, 255, 0.95);
    color: #DC2626;
    padding: 8px 16px;
    border-radius: 50px;
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 20px;
}

.hero-sub {
    font-size: 15px;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 8px;
}

.hero-title {
    font-size: 32px;
    font-weight: 800;
    color: white;
    line-height: 1.3;
    margin-bottom: 8px;
}

.hero-highlight {
    color: #FDE047;
}

.hero-amount {
    font-size: 15px;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 28px;
}

.hero-cta {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: white;
    color: #2563EB;
    padding: 18px 40px;
    border-radius: 16px;
    font-size: 17px;
    font-weight: 700;
    text-decoration: none;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
}

.hero-cta:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2);
}

/* ========== Footer ========== */
.site-footer {
    background: #E3F2FD;
    color: #333;
    padding: 30px 20px;
    margin-top: 50px;
}

.footer-content {
    max-width: 768px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 20px;
}

.footer-brand {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 10px;
    color: #1976D2;
}

.footer-info {
    list-style: none;
    padding: 0;
}

.footer-info li {
    margin-bottom: 5px;
    font-size: 14px;
    color: #666;
}

.footer-right a {
    color: #1976D2;
    text-decoration: none;
}

/* ========== Responsive ========== */
@media (max-width: 768px) {
    body {
        padding-top: 110px;
    }
    
    .info-card-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .hero-title {
        font-size: 26px;
    }
    
    .tab-link {
        font-size: 12px;
        padding: 10px 4px;
    }
    
    .footer-content {
        flex-direction: column;
        text-align: center;
    }
    }
